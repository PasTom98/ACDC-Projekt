pipeline{
    environment {     
    ssh_vm= credentials('local_ssh')     
    }
    agent {
        label 'deploy'
        }
    stages{
        stage("Pull Docker-Image") {
            steps{
                script{
                sh 'ssh -tto StrictHostKeyChecking=no debian@localhost -p 22022 "docker pull pato98/acdc_presentation:latest && docker run acdc_presentation"'
                }
            }
        }
        stage("Delete current running container"){
            steps{
                script {
                    try {
                        sh 'docker system prune -a --volumes -f'
                        echo 'Pruned docker succesfully'
                    } catch (Exception e) {
                        echo 'Something went wrong pruning docker data'
                    }
                }
            }
        }
    }
}